<!DOCTYPE html>

<script type="text/javascript">
    // window.__CRRTCSDK_NO_CONSOLE = true;
    window.__CRKEY = 'CRDEMO';
    var protocol = window.location.protocol;
    var host = window.location.host;
    var isLocal = host.includes('127.0.0.1') || host.includes('localhost:') || protocol.includes('file');
    var isMobile = navigator.userAgent.includes('Mobile') || navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad') || navigator.userAgent.includes('Android');

    console.log(`isLocal: ${isLocal}`);
    console.log(`href: ${window.location.href}`);
    console.log(`referrer: ${document.referrer}`);
    console.log(`page protocol: ${protocol}`);
    console.log(`isMobile: ${isMobile}`);

    // http强制跳转https
    if (protocol != 'https:' && !isLocal) {
        location.href = 'https:' + location.href.substring(protocol.length);
    }

    // // 移动端/pc端自动跳转
    // const htmlName = /\w+.html/.exec(window.location.href)[0];
    // console.log(htmlName);
    // if (isMobile && !htmlName.includes('m_')) { // 移动端打开pc页面
    //     window.location.href = window.location.href.replace(htmlName, `m_${htmlName}`);
    // } else if (!isMobile && htmlName.includes('m_')) { // pc端打开移动端页面
    //     window.location.href = window.location.href.replace(htmlName, `${htmlName.replace('m_', '')}`);
    // }

    // ios上webview打开，如果referrer为空则会获取不到相关媒体api，这里强制刷新一下，让referrer不为空(Firefox不行)
    // 2025-08-15 暂时注释，中债环境始终获取不到referrer
    // if (document.referrer == '' && !isLocal && !navigator.userAgent.includes('Firefox')) {
    //     window.location.reload();
    // }
</script>

<html>

<head>
  <script type="text/javascript" src="./js/vconsole.min.js"></script>
  <script>
    var vConsole = new VConsole();
  </script>
  <meta charset="UTF-8" />
  <title>视频呼叫Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="W_design" content="750" />
  <meta name="description" content="webRTC" />
  <link rel="shortcut icon" href="./image/favicon.ico" />
  <link rel="stylesheet" href="./lib/layui/css/layui.css" />
  <link rel="stylesheet" type="text/css" href="./css/m_videoCall.css?v=1" />
  <script type="text/javascript" src="./js/jquery.2.0.0.min.js"></script>
  <script type="text/javascript">

    // 设置rem根字体大小
    function setHtmlFontSize() {
      const docEl = document.documentElement;
      const designMeta = document.querySelector('meta[name="W_design"]');
      const designWidth = designMeta ? parseInt(designMeta.getAttribute('content'), 10) : 750;
      const clientWidth = docEl.clientWidth;
      const clientHeight = docEl.clientHeight;

      if (!clientWidth || !clientHeight) return;

      // 判断横竖屏。如果宽度大于高度，则为横屏，使用高度作为计算基准。
      const baseSize = clientWidth > clientHeight ? clientHeight : clientWidth;
      docEl.style.fontSize = (100 * baseSize) / designWidth + 'px';
    }
    setHtmlFontSize()
    window.onresize = setHtmlFontSize;
  </script>
<script src="SDK/RTCSDKV2.min.js"></script></head>

<body scroll="no">
  <!--登录页-->
  <div class="login_box">
    <div class="head_img"><span class="logo_img"></span></div>
    <h2>视频呼叫系统</h2>
    <ul class="login_input">
      <li class="input_li">
        <!-- 禁用自动填充 -->
        <input type="password" style="display: none" autocomplete="new-password" />
        <input type="text" class="userName" placeholder="请输入昵称" id="userName" />
      </li>
      <li class="login_btn_li"><button class="login_btn" id="login_btn">登录</button></li>
      <li class="cf"><span class="server_set" id="server_set">服务器设置</span></li>
    </ul>
    <div class="version">sdk ver : <span></span></div>
  </div>
  <!--服务器设置页-->
  <div class="server_set_box hide">
    <h3 class="head"><span id="close_ser_page"></span>服务器设置</h3>
    <div class="server_b">
      <ul class="server_input">
        <li class="li2"><span>服务器：</span><input type="text" value="" placeholder="请输入服务器地址" id="ser_address" /></li>
        <li class="li2">
          <span>AppID：</span><input type="text" value="默认" placeholder="请输入账号" id="ser_acount" />
          <script>
            var serAddress = window.location.host;
            serAddress = sessionStorage.getItem('CRServerAdd') || window.location.host;
            if (serAddress.includes('127.0.0.1') || serAddress.includes('localhost') || !serAddress) serAddress = '';
            document.getElementById('ser_address').value = serAddress;
            console.log(document.getElementById('ser_address').value);
            var serAcount = localStorage.getItem('cr_account') || '默认';
            document.getElementById('ser_acount').value = serAcount;
          </script>
        </li>
        <li><span>Secret：</span><input type="password" value="默认" placeholder="请输入密码" id="ser_password" /></li>
      </ul>
      <div class="server_btn cf">
        <button class="server_btn_reset" id="server_reset">重置为默认</button>
        <button class="server_btn_keep" id="server_keep">保存</button>
      </div>
    </div>
  </div>
  <!--坐席队列-->
  <div class="queue_box2 hide">
    <h3 class="head"><span id="queue_box2_close">注销</span>请选择业务</h3>
    <ul class="queue_list" id="queueList2">
      <!--<li>-->
      <!--<p class="p1">窗口名称：深圳</p>-->
      <!--<p class="p2"><span>坐席人数：1</span>-->
      <!--<span>排队人数：1</span>-->
      <!--<span>会话中人数：1</span>-->
      <!--</p>-->
      <!--<span class="queue_state">未服务</span>-->
      <!--</li>-->
    </ul>
    <div class="queue_foot cf">
      <span class="system_auto check" id="system_auto">系统自动分配客户</span>
      <button class="next_one hide" id="next_user">下一位客户</button>
    </div>
  </div>
  <!--客户队列-->
  <div class="queue_box1 hide">
    <h3 class="head"><span id="queue_box1_close">注销</span>请选择业务</h3>
    <ul class="queue_list" id="queueList1">
      <!--<li>-->
      <!--<p class="p1"><span class="queue_name">深圳</span><span>（0人等待）</span></p>-->
      <!--<p class="p2">描述一下:哈哈哈哈哈哈哈</p>-->
      <!--</li>-->
    </ul>
  </div>
  <!--正在排队-->
  <div class="line_up hide">
    <h3 class="head">正在排队......</h3>
    <div class="show_server">您正在排队等候 【<span id="queue_name"></span>】服务中，已等候</div>
    <div class="time_b"><span class="time" id="line_up_time">0秒</span></div>
    <div id="user_position" class="other_num">前面还有 <span id="user_num">0</span> 位用户</div>
    <button class="line_up_btn">取消排队</button>
  </div>
  <!--模式选择页-->
  <div class="mode_select_box hide">
    <h3 class="head">
      <span id="mode_select_close">注销</span>
      请选择呼叫模式
    </h3>
    <div class="content_box">
      <button id="queue_call_btn">排队叫号</button>
      <button id="direct_call_btn">直接呼叫</button>
    </div>
  </div>
  <!--身份选择页-->
  <div class="identity_select_box hide">
    <h3 class="head">
      <span id="identity_select_back">返回</span>
      请选择您的身份
    </h3>
    <div class="content_box">
      <button id="identity_agent_btn">我是坐席</button>
      <button id="identity_customer_btn">我是客户</button>
    </div>
  </div>
  <!--直接呼叫页-->
  <div class="direct_call_box hide">
    <h3 class="head">
      <span id="direct_call_back">返回</span>
      直接呼叫
    </h3>
    <div class="content_box">
      <div class="my_id">您的ID：<span id="my_id_display_2"></span></div>
      <div class="input_label">请输入对方ID或等待对方呼叫:</div>
      <ul class="login_input">
        <li class="input_li">
          <input type="text" placeholder="请输入对方ID" id="peer_id_input" class="userName" />
        </li>
        <li class="login_btn_li"><button class="login_btn" id="direct_call_start_btn">呼叫</button></li>
      </ul>
    </div>
  </div>
  <!--会话页面-->
  <div class="dialog hide">
    <h3 class="head">
      <p class="p1">您正在和 【<span id="call_user_name">connie</span>】 会话中，通话时长:</p>
      <p class="p2" id="video_time">4分21秒</p>
    </h3>
    <div class="video" id="video_box">
      <div class="video_contain" id="video_main"></div>
      <div class="video_contain" id="video_local"></div>
    </div>
    <div class="foot">
      <input type="hidden" value="" id="mySpkerId" />
      <div style="width: 100%; height: 1rem; display: none" id="change_style">
        <button id="video_lower">流畅</button>
        <button id="video_normal">标清</button>
        <button id="video_height">高清</button>
        <button id="video_max">超清</button>
      </div>
      <button id="meet_colse_btn">挂断</button>
      <button id="video_operate_btn">关闭摄像头</button>
      <button id="change_camera">切换摄像头</button>
      <button style="margin-right: 0" id="mic_operate_btn">关闭麦克风</button>
    </div>
  </div>
  <div class="loading hide" id="loading"><img src="./image/loading-0.gif" /></div>

  <script type="text/javascript" src="./lib/layui/layui.js"></script>
  <script type="text/javascript" src="./js/md5.js"></script>
  <script type="text/javascript" src="./js/m_videoCall.js"></script>
</body>

<script>
  $(function() {
    VideoCall.init();
  });
</script>

</html>